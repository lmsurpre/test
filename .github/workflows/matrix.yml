name: matrix test

on:
  push:
  workflow_dispatch:
    inputs:
      x:
        definition:
        type: string

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - id: set-matrix
        run: |
          x=${{github.event.inputs.x}}
          if [ -z ${x} ]
            echo "::set-output name=x::['${x}']"
          else
            echo "::set-output name=x::['a','b','c']"
          fi

          y=${{github.event.inputs.y}}
          if [ -z ${y} ]
            echo "::set-output name=y::['${y}']"
          else
            echo "::set-output name=y::["1","2","3"]"
          fi
    outputs:
      x: ${{ steps.set-matrix.outputs.x }}
      y: ${{ steps.set-matrix.outputs.y }}
  my_job:
    needs: setup
    runs-on: ubuntu-latest
    strategy:
      matrix:
        x: ${{fromJSON(needs.setup.outputs.x)}}
        y: ${{fromJSON(needs.setup.outputs.y)}}
    steps:
      - run: echo ${{matrix.x}}${{matrix.y}}

